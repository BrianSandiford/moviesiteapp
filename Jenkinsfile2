node {
    
    def app

    stage('Clone repository') {

        /* Cloning the Repository to our Workspace */

        checkout scm
    }

    stage('Build image') {

        /* This builds the actual image */

        app = docker.build("moviesiteapp_x86")
      
    }
    withEnv(['registryCredentials=nexus-registry',
             'registry=ec2-3-135-206-2.us-east-2.compute.amazonaws.com:8083/']) {
     stage('Push image') {
        
          /* 
	 	 	You would need to first register with DockerHub before you can push images to your account
		 */
         docker.withRegistry( 'http://'+registry, registryCredentials ) {
            app.push("${env.BUILD_NUMBER}")
            app.push("latest")
            } 
                echo "Trying to Push Docker Build to DockerHub"
     } 
    }
    
}
